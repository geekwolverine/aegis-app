{"version":3,"sources":["webpack://aegis-app/./src/domain/utils.js","webpack://aegis-app/./src/services/address-service.js","webpack://aegis-app/./src/services/event-bus.js","webpack://aegis-app/./src/services/index.js","webpack://aegis-app/./src/services/inventory-service.js","webpack://aegis-app/./src/services/payment-service.js","webpack://aegis-app/./src/services/shipping-service.js"],"names":["compose","funcs","initVal","reduceRight","val","func","composeAsync","then","Promise","resolve","asyncPipe","obj","reduce","o","f","passwd","process","env","ENCRYPTION_PWD","algo","key","crypto","String","iv","Buffer","alloc","encrypt","text","cipher","encrypted","update","decrypt","cipherText","console","log","decipher","decrypted","hash","data","digest","uuid","nanoid","makeArray","v","Array","isArray","makeObject","prop","p","c","async","promise","result","ok","object","asObject","asArray","error","require","SmartyStreetsSDK","SmartyStreetsCore","core","Lookup","usStreet","disabled","SMARTY_DISABLED","authId","SMARTY_AUTH_ID","authToken","SMARTY_AUTH_TOKEN","credentials","StaticCredentials","client","buildClient","Address","validateAddress","address","lookup","inputId","street","maxCandidates","send","response","Error","candidate","lookups","validatedAddress","deliveryLine1","deliveryLine2","lastLine","join","message","_notify","notify","Event","_listen","listen","model","EventBus","topic","args","options","Payment","authorizePayment","id","amount","source_id","customer_id","autocomplete","currency","payload","idempotency_key","amount_money","location_id","reference_id","note","app_fee_money","completePayment","orderNo","refundPayment","createEventMessage","requester","service","type","name","eventSource","eventTarget","eventType","eventName","eventTime","Date","getTime","eventUuid","eventData","createCommandEvent","commandName","commandResp","commandArgs","Shipping","serviceName","shipOrder","shipTo","shipFrom","lineItems","signature","externalId","respondOn","trackShipment","shipmentId","trackingId","verifyDelivery","returnShipment","getPayload","event","payloads","trackingStatus","proofOfDelivery","getProperty"],"mappings":"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;;;;;;;ACjBiC;AACF;AACI;AACF;AACC;;;;;;;;;;;;;;ACJvB;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,U;;;;;;;;;;;;;;;;;;;ACVa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AAAA;AAAA,+CAvBA;AAAA;AAAA;AAyBO,IAAMC,OAAO,GAAG;EACrB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACQC,gBAAgB,4BACpBC,EAAE,EACFC,MAAM,EACNC,SAAS,EACTC,WAAW,EAGX;IAAA;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAFAC,YAAY,0EAAG,KAAK;cACpBC,QAAQ,0EAAG,KAAK;cAEVC,OAAO,GAAG;gBACdC,eAAe,EAAEP,EAAE;gBACnBQ,YAAY,EAAE;kBACZP,MAAM,EAANA,MAAM;kBACNI,QAAQ,EAARA;gBACF,CAAC;gBACDH,SAAS,EAATA,SAAS;gBACTE,YAAY,EAAZA,YAAY;gBACZD,WAAW,EAAXA,WAAW;gBACXM,WAAW,EAAE,eAAe;gBAC5BC,YAAY,EAAE,QAAQ;gBACtBC,IAAI,EAAE,mBAAmB;gBACzBC,aAAa,EAAE;kBACbX,MAAM,EAAE,EAAE;kBACVI,QAAQ,EAAE;gBACZ;cACF,CAAC;cACD;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;cArCI,iCA2CO,MAAM;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EACf,CAAC;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","file":"732.js","sourcesContent":["'use strict'\n\nimport crypto from 'crypto'\nimport { nanoid } from 'nanoid'\n\nexport function compose (...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight((val, func) => func(val), initVal)\n  }\n}\n\nexport function composeAsync (...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight(\n      (val, func) => val.then(func),\n      Promise.resolve(initVal)\n    )\n  }\n}\n\n/**\n * @callback pipeFn\n * @param {object} obj - the object to compose\n * @returns {object} - the composed object\n */\n\n/**\n * @param {pipeFn} func\n */\nexport const asyncPipe = (...func) => obj =>\n  func.reduce((o, f) => o.then(f), Promise.resolve(obj))\n\nconst passwd = process.env.ENCRYPTION_PWD\nconst algo = 'aes-192-cbc'\nconst key = crypto.scryptSync(String(passwd), 'salt', 24)\nconst iv = Buffer.alloc(16, 0)\n\nexport function encrypt (text) {\n  const cipher = crypto.createCipheriv(algo, key, iv)\n  let encrypted = cipher.update(text, 'utf8', 'hex')\n  encrypted += cipher.final('hex')\n  return encrypted\n}\n\nexport function decrypt (cipherText) {\n  console.log('decrypt(%s)', cipherText)\n  const decipher = crypto.createDecipheriv(algo, key, iv)\n  let decrypted = decipher.update(cipherText, 'hex', 'utf8')\n  decrypted += decipher.final('utf8')\n  return decrypted\n}\n\nexport function hash (data) {\n  return crypto\n    .createHash('sha1')\n    .update(data)\n    .digest('hex')\n}\n\nexport function uuid () {\n  // return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n  //   (c ^ (crypto.randomBytes(16)[0] & (15 >> (c / 4)))).toString(16)\n  // );\n  return nanoid()\n}\n\nexport function makeArray (v) {\n  return Array.isArray(v) ? v : [v]\n}\n\nexport function makeObject (prop) {\n  if (Array.isArray(prop)) {\n    return prop.reduce((p, c) => ({ ...p, ...c }))\n  }\n  return prop\n}\n\n/**\n *\n * @param {Promise<{\n * ok:()=>any,\n *\n * }} promise\n * @returns\n */\nexport function async (promise) {\n  return promise\n    .then(result => ({\n      ok: true,\n      object: result,\n      asObject: () => makeObject(result),\n      asArray: () => makeArray(result)\n    }))\n    .catch(error => {\n      console.error(error)\n      return Promise.resolve({ ok: false, error })\n    })\n}\n","'use strict'\n\nconst uuid = require('../domain/utils').uuid\nconst SmartyStreetsSDK = require('smartystreets-javascript-sdk')\n\nconst SmartyStreetsCore = SmartyStreetsSDK.core\nconst Lookup = SmartyStreetsSDK.usStreet.Lookup\n\n// for Server-to-server requests, use this code:\nconst disabled = process.env.SMARTY_DISABLED || false\nconst authId = process.env.SMARTY_AUTH_ID\nconst authToken = process.env.SMARTY_AUTH_TOKEN\nconst credentials = new SmartyStreetsCore.StaticCredentials(authId, authToken)\n\nconst client = SmartyStreetsCore.buildClient.usStreet(credentials)\n\n/**\n * @typedef {{function(address):Promise<string>}} Address\n */\nexport const Address = {\n  // Documentation for input fields can be found at:\n  // https://smartystreets.com/docs/us-street-api#input-fields\n\n  async validateAddress (address) {\n    console.log(`REAL validating address...${address}`)\n\n    if (!address) {\n      console.log('no address')\n      return\n    }\n\n    if (disabled) {\n      console.log('address service disabled')\n      return address\n    }\n\n    try {\n      let lookup = new Lookup()\n      lookup.inputId = uuid()\n      lookup.street = address\n      lookup.maxCandidates = 1\n\n      let response\n      try {\n        response = await client.send(lookup)\n      } catch (error) {\n        throw new Error(error)\n      }\n\n      const candidate = response.lookups[0].result[0]\n      if (!candidate) {\n        throw new Error('invalid address')\n      }\n\n      const validatedAddress = [\n        candidate.deliveryLine1,\n        candidate.deliveryLine2,\n        candidate.lastLine\n      ].join(' ')\n\n      console.log(`address: ${validatedAddress}`)\n\n      if (!validatedAddress) {\n        throw new Error('invalid address')\n      }\n      return validatedAddress\n    } catch (error) {\n      console.error(error)\n      throw new Error('Address service error', error.message)\n    }\n  }\n}\n","\"use strict\";\n\n// Build EventBus client for host\nimport { listen, notify } from \"../adapters\";\nimport { Event } from \"./event-service\";\n\nconst _notify = notify(Event);\nconst _listen = listen(Event);\nconst model = { listen: _listen };\n\nexport const EventBus = {\n  notify(topic, message) {\n    return _notify({ model, args: [topic, message] });\n  },\n  listen(options) {\n    return _listen({ model, args: [options] });\n  },\n};\n","export * from \"./address-service\";\nexport * from \"./event-service\";\nexport * from \"./inventory-service\";\nexport * from \"./payment-service\";\nexport * from \"./shipping-service\";\nexport * from \"./event-bus\";","'use strict'\n\n// JSON.stringify({\n//     eventType: \"Command\",\n//     eventTime: new Date().toISOString(),\n//     eventSource: \"orderService\",\n//     eventData: {\n//       replyChannel: \"orderChannel\",\n//       commandName: \"pickOrder\",\n//       commandArgs: {\n//       }\n\n","\"use strict\";\n\n/**\n * @callback authorizePaymentType\n * @param {string} id\n * @param {number} amount\n * @param {string} source_id\n * @param {string} customer_id\n * @param {boolean} [autocomplete]\n * @returns {Promise<string>}\n */\n\n/**\n * @typedef PaymentService\n * @property {authorizePaymentType} authorizePayment\n * @property {function()} completePayment\n * @property {function()} refundPayment\n */\n\n// import { Client, Environment, ApiError } from \"square\";\n\n// const client = new Client({\n//   environment: Environment.Sandbox,\n//   accessToken: process.env.SQUARE_ACCESS_TOKEN,\n// });\n\nexport const Payment = {\n  /**\n   * @type {authorizePaymentType}\n   * @param {*} id\n   * @param {*} amount\n   * @param {*} source_id\n   * @param {*} customer_id\n   * @param {*} autocomplete\n   * @param {*} currency\n   */\n  async authorizePayment(\n    id,\n    amount,\n    source_id,\n    customer_id,\n    autocomplete = false,\n    currency = \"USD\"\n  ) {\n    const payload = {\n      idempotency_key: id,\n      amount_money: {\n        amount,\n        currency,\n      },\n      source_id,\n      autocomplete,\n      customer_id,\n      location_id: \"XK3DBG77NJBFX\",\n      reference_id: \"123456\",\n      note: \"Brief description\",\n      app_fee_money: {\n        amount: 10,\n        currency: \"USD\",\n      },\n    };\n    /*\n    const bodyAmountMoney = {};\n    bodyAmountMoney.amount = 200;\n    bodyAmountMoney.currency = \"USD\";\n\n    const bodyTipMoney = {};\n    bodyTipMoney.amount = 198;\n    bodyTipMoney.currency = \"CHF\";\n\n    const bodyAppFeeMoney = {};\n    bodyAppFeeMoney.amount = 10;\n    bodyAppFeeMoney.currency = \"USD\";\n\n    const body = {\n      sourceId: \"ccof:uIbfJXhXETSP197M3GB\",\n      idempotencyKey: \"4935a656-a929-4792-b97c-8848be85c27c\",\n      amountMoney: bodyAmountMoney,\n    };\n\n    body.tipMoney = bodyTipMoney;\n    body.appFeeMoney = bodyAppFeeMoney;\n    body.delayDuration = \"delay_duration6\";\n    body.autocomplete = true;\n    body.orderId = \"order_id0\";\n    body.customerId = \"VDKXEEKPJN48QDG3BGGFAK05P8\";\n    body.locationId = \"XK3DBG77NJBFX\";\n    body.referenceId = \"123456\";\n    body.note = \"Brief description\";\n\n    // try {\n    //   const {\n    //     result,\n    //     ...httpResponse\n    //   } = await client.paymentsApi.createPayment(body);\n    //   // Get more response info...\n    //   // const { statusCode, headers } = httpResponse;\n    // } catch (error) {\n    //   if (error instanceof ApiError) {\n    //     const errors = error.result;\n    //     // const { statusCode, headers } = error;\n    //   }\n    // }\n    */\n    return \"1234\";\n  },\n\n  /*\n  const response ={\n  \"payment\": {\n    \"id\": \"GQTFp1ZlXdpoW4o6eGiZhbjosiDFf\",\n    \"created_at\": \"2019-07-10T13:23:49.154Z\",\n    \"updated_at\": \"2019-07-10T13:23:49.446Z\",\n    \"amount_money\": {\n      \"amount\": 200,\n      \"currency\": \"USD\"\n    },\n    \"app_fee_money\": {\n      \"amount\": 10,\n      \"currency\": \"USD\"\n    },\n    \"total_money\": {\n      \"amount\": 200,\n      \"currency\": \"USD\"\n    },\n    \"status\": \"COMPLETED\",\n    \"source_type\": \"CARD\",\n    \"card_details\": {\n      \"status\": \"CAPTURED\",\n      \"card\": {\n        \"card_brand\": \"VISA\",\n        \"last_4\": \"1111\",\n        \"exp_month\": 7,\n        \"exp_year\": 2026,\n        \"fingerprint\": \"sq-1-TpmjbNBMFdibiIjpQI5LiRgNUBC7u1689i0TgHjnlyHEWYB7tnn-K4QbW4ttvtaqXw\",\n        \"card_type\": \"DEBIT\",\n        \"prepaid_type\": \"PREPAID\",\n        \"bin\": \"411111\"\n      },\n      \"entry_method\": \"ON_FILE\",\n      \"cvv_status\": \"CVV_ACCEPTED\",\n      \"avs_status\": \"AVS_ACCEPTED\",\n      \"auth_result_code\": \"nsAyY2\",\n      \"statement_description\": \"SQ *MY MERCHANT\"\n    },\n    \"location_id\": \"XTI0H92143A39\",\n    \"order_id\": \"m2Hr8Hk8A3CTyQQ1k4ynExg92tO3\",\n    \"reference_id\": \"123456\",\n    \"note\": \"Brief description\",\n    \"customer_id\": \"RDX9Z4XTIZR7MRZJUXNY9HUK6I\",\n    \"receipt_number\": \"GQTF\",\n    \"receipt_url\": \"https://squareup.com/receipt/preview/GQTFp1ZlXdpoW4o6eGiZhbjosiDFf\"\n  }\n}\n  /*\n{\n  \"errors\": [\n    {\n      \"code\": \"VALUE_EMPTY\",\n      \"detail\": \"Field must not be blank\",\n      \"field\": \"source_id\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    },\n    {\n      \"code\": \"VALUE_EMPTY\",\n      \"detail\": \"Field must not be blank\",\n      \"field\": \"idempotency_key\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    },\n    {\n      \"code\": \"MISSING_REQUIRED_PARAMETER\",\n      \"detail\": \"Field must be set\",\n      \"field\": \"amount_money\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    }\n  ]\n}\n  */\n\n  async completePayment(model) {\n    console.log(\"REAL completing payment: %s\", model.orderNo);\n    return \"1234\";\n  },\n\n  async refundPayment(model) {\n    console.log(\"REAL refunding payment: %s\", model.orderNo);\n  },\n};\n","\"use strict\";\n\n/**\n * @typedef {import('../adapters/event-adapter').EventMessage} EventMessage\n */\n\n/**\n * @typedef {import('../adapters/event-adapter').CommandEvent} CommandEvent\n */\n\n/**\n * @callback shipOrder\n * @param {string} shipTo\n * @param {string} shipFrom\n * @param {string} lineItems\n * @param {string} signature\n * @param {string} externalId\n * @param {string} requester\n * @param {string} respondOn\n * @returns {EventMessage}\n */\n\n/**\n * @callback trackShipment\n * @param {string} shipmentId\n * @param {string} externalId\n * @param {string} requester\n * @param {string} respondOn\n * @returns {EventMessage}\n */\n\n/**\n * @typedef {string} functionName\n */\n\n/**\n * @typedef {Object} shippingService formats and parses shipping event messages\n * @property {string} serviceName - programmatic service name in eventSource/Target\n * @property {string} topic - event topic \"shippingChannel\" when sending messasges\n * @property {shipOrder} shipOrder - format event message requesting shipping label and pickup of order\n * @property {trackShipment} trackShipment - report on location/status of parcel\n * @property {function():EventMessage} verifyDelivery - ensure customer recieved parcel\n * @property {function():EventMessage} returnShipment - return to sender if refunding\n * @property {function(functionName,EventMessage):{[key]:string}} getPayload - extract payload\n */\n\nfunction createEventMessage({ requester, service, type, name, id, data }) {\n  return {\n    eventSource: requester,\n    eventTarget: service,\n    eventType: type,\n    eventName: name,\n    eventTime: new Date().getTime(),\n    eventUuid: id,\n    eventData: data,\n  };\n}\n\nfunction createCommandEvent(name, topic, args) {\n  return {\n    commandName: name,\n    commandResp: topic,\n    commandArgs: { ...args },\n  };\n}\n\n/**\n * Shipping service events\n * @type {shippingService}\n */\nexport const Shipping = {\n  serviceName: \"shippingService\",\n  topic: \"shippingChannel\",\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {shipMessage}\n   */\n  shipOrder({\n    shipTo,\n    shipFrom,\n    lineItems,\n    signature,\n    externalId,\n    requester,\n    respondOn,\n  }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.shipOrder.name,\n      id: externalId,\n      data: createCommandEvent(this.shipOrder.name, respondOn, {\n        shipTo,\n        shipFrom,\n        lineItems,\n        signature,\n        externalId,\n      }),\n    });\n  },\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {EventMessage}\n   */\n  trackShipment({ externalId, shipmentId, trackingId, requester, respondOn }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.trackShipment.name,\n      id: externalId,\n      data: createCommandEvent(this.trackShipment.name, respondOn, {\n        externalId,\n        shipmentId,\n        trackingId,\n      }),\n    });\n  },\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {EventMessage}\n   */\n  verifyDelivery({ requester, respondOn, trackingId, externalId }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.verifyDelivery.name,\n      id: externalId,\n      data: createCommandEvent(this.verifyDelivery.name, respondOn, {\n        externalId,\n        trackingId,\n      }),\n    });\n  },\n\n  returnShipment({ requester, respondOn, shipmentId, externalId }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      id: externalId,\n      name: this.returnShipment.name,\n      data: createCommandEvent(this.returnShipment, respondOn, {\n        shipmentId,\n        externalId,\n      }),\n    });\n  },\n\n  getPayload(func, event) {\n    const payloads = {\n      [this.shipOrder.name]: {\n        shipmentId: event.eventData.shipmentId,\n      },\n      [this.trackShipment.name]: {\n        trackingId: event.eventData.trackingId,\n        trackingStatus: event.eventData.trackingStatus,\n      },\n      [this.verifyDelivery.name]: {\n        proofOfDelivery: event.eventData.proofOfDelivery,\n      },\n    };\n    return payloads[func];\n  },\n\n  getProperty(event, key) {\n    return event.eventData[key];\n  },\n};\n"],"sourceRoot":""}